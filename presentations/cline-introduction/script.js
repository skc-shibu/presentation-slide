const presentationData = {
  id: "clinePresentation",
  title: "CLINEç´¹ä»‹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³",
  slides: [
    {
      id: "slide1",
      type: "title_subtitle",
      title: "çš†ã•ã‚“ã®é–‹ç™ºã‚’å¤‰ãˆã‚‹CLINE",
      subtitle: "AIãŒã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã«ãªã‚Šã¾ã™"
    },
    {
      id: "slide2",
      type: "explanation_list",
      title: "CLINEã£ã¦ä½•ï¼Ÿ",
      items: [
        { title: "AIæ­è¼‰ã®VSCodeæ‹¡å¼µæ©Ÿèƒ½", content: "ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ/ä¿®æ­£/ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹ç¯‰ã‚’AIãŒæ”¯æ´ã™ã‚‹é–‹ç™ºè€…å‘ã‘ãƒ„ãƒ¼ãƒ«" },
        { title: "ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ï¼†å¤šãƒ¢ãƒ‡ãƒ«å¯¾å¿œ", content: "OpenAIãƒ»Anthropicãƒ»Googleãƒ»DeepSeekãªã©è¤‡æ•°AIãƒ¢ãƒ‡ãƒ«ã¨é€£æºå¯èƒ½ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè‡ªç”±ãªç’°å¢ƒ" },
        { title: "é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çµ±åˆ", content: "ã‚³ãƒ¼ãƒ‰ç·¨é›†ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ä¿®æ­£ã¾ã§ã‚¨ãƒ‡ã‚£ã‚¿å†…ã§å®Œçµã•ã›ã‚‹ã€ŒAIãƒšã‚¢ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€ã‚’å®Ÿç¾" }
      ]
    },
    {
      id: "slide3",
      type: "features_grid",
      title: "ã“ã‚“ãªã«ä¾¿åˆ©ï¼ä¸»ãªæ©Ÿèƒ½",
      features: [
        { icon: "ğŸ’»", title: "ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆ", description: "ã€Œã“ã‚“ãªæ©Ÿèƒ½ãŒæ¬²ã—ã„ã€ã¨ä¼ãˆã‚‹ã ã‘ã§" },
        { icon: "ğŸ”§", title: "ã‚¨ãƒ©ãƒ¼ã‚’è‡ªå‹•ä¿®æ­£", description: "å›°ã£ãŸæ™‚ã‚‚å®‰å¿ƒ" },
        { icon: "ğŸŒ", title: "APIã¨ç°¡å˜é€£æº", description: "å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®æ¥ç¶šã‚‚æ¥½ã€…" }
      ],
      footer: [
        { icon: "ğŸš€", text: "ç”Ÿç”£æ€§å‘ä¸Š" },
        { icon: "ğŸ§ ", text: "å­¦ç¿’æ”¯æ´" },
        { icon: "âš¡", text: "é«˜é€Ÿé–‹ç™º" }
      ]
    },
    {
      id: "slide4",
      type: "benefits_list",
      title: "CLINEã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆ",
      benefits: [
        { icon: "ğŸš€", title: "é–‹ç™ºãŒé€Ÿããªã‚‹", description: "ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã§ä½œæ¥­æ™‚é–“ã‚’å¤§å¹…çŸ­ç¸®" },
        { icon: "ğŸ§ ", title: "é›†ä¸­åŠ›ãŒç¶šã", description: "ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¤ãƒƒãƒãŒæ¸›ã‚Šã¾ã™" },
        { icon: "ğŸ¨", title: "ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè‡ªç”±", description: "ã‚ãªãŸã®ã‚¹ã‚¿ã‚¤ãƒ«ã«åˆã‚ã›ã¦èª¿æ•´å¯èƒ½" }
      ],
      footer: [
        { icon: "ğŸ‘", text: "ä½¿ã„ã‚„ã™ã„" },
        { icon: "ğŸ”Œ", text: "æ‹¡å¼µå¯èƒ½" },
        { icon: "ğŸ†“", text: "ç„¡æ–™ãƒ—ãƒ©ãƒ³ã‚ã‚Š" }
      ]
    },
    {
      id: "slide5",
      type: "steps_list",
      title: "å§‹ã‚æ–¹",
      steps: [
        { number: "1", title: "ğŸ” ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«", content: "1. VSCodeã‚’é–‹ã<br>2. æ‹¡å¼µæ©Ÿèƒ½ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯<br>3. 'Cline'ã§æ¤œç´¢<br>4. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" },
        { number: "2", title: "ğŸ”‘ APIè¨­å®š", content: "1. Anthropic/OpenAIãªã©å¥½ã¿ã®ãƒ¢ãƒ‡ãƒ«é¸æŠ<br>2. APIã‚­ãƒ¼ã‚’å…¥åŠ›<br>(è¨­å®šã¯ä¸€åº¦ã ã‘)" },
        { number: "3", title: "âš ï¸ æ³¨æ„ç‚¹", content: "â€¢ APIåˆ©ç”¨ã«ã¯å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãŒå¿…è¦<br>â€¢ ç„¡æ–™ãƒ—ãƒ©ãƒ³ã¨æœ‰æ–™ãƒ—ãƒ©ãƒ³ã®é•ã„<br>â€¢ åˆ¥é€”è³‡æ–™ä½œæˆä¸­ (è©³ç´°ã¯ç§ã«å£°ã‚’ã‹ã‘ã¦ãã ã•ã„)" }
      ],
      footer: [
        { icon: "â±ï¸", text: "æ‰€è¦æ™‚é–“: 5åˆ†" },
        { icon: "ğŸ’¡", text: "ã™ãã«ä½¿ã„å§‹ã‚ã‚‰ã‚Œã¾ã™" }
      ]
    },
    {
      id: "slide6",
      type: "reveal_text",
      title: "å®Ÿã¯ãŠä¼ãˆã—ãŸã„ã“ã¨...",
      revealText: "ã“ã®ãƒ—ãƒ¬ã‚¼ãƒ³ã‚µã‚¤ãƒˆè‡ªä½“ã‚‚CLINEã§ä½œæˆã—ã¾ã—ãŸ",
      highlight: "ç§ãŒæŒ‡ç¤ºã—ãŸã ã‘ã§ã‚³ãƒ¼ãƒ‰ã¯å…¨ã¦AIãŒç”Ÿæˆ",
      additionalText: "CLINEã®å®ŸåŠ›ã‚’ä½“æ„Ÿã—ã¦ãã ã•ã„"
    },
    {
      id: "slide7",
      type: "qa_list",
      title: "è³ªå•ã‚¿ã‚¤ãƒ ",
      items: [
        { title: "ä½•ã‹è³ªå•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", content: "CLINEã«ã¤ã„ã¦æ°—ã«ãªã‚‹ç‚¹ã‚„ç–‘å•ç‚¹ã‚’ãŠèã‹ã›ãã ã•ã„" }
      ]
    },
    {
      id: "slide8",
      type: "closing_title",
      title: "ä¸€ç·’ã«é–‹ç™ºã®æœªæ¥ã‚’ä½œã‚Šã¾ã—ã‚‡ã†",
      thankYouText: "ã”æ¸…è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ"
    }
  ]
};

let currentSlideIndex = 0;

document.addEventListener('DOMContentLoaded', () => {
  const slideDisplayArea = document.getElementById('slide-display-area');
  const prevBtn = document.querySelector('.prev-btn');
  const nextBtn = document.querySelector('.next-btn');
  const progressBar = document.querySelector('.progress-bar');

  function renderSlide(slideIndex) {
    if (!presentationData) {
      console.error(`Presentation data not found.`);
      slideDisplayArea.innerHTML = `<div class="slide active error"><p>Error: Presentation data not found.</p></div>`;
      return;
    }

    if (slideIndex < 0 || slideIndex >= presentationData.slides.length) {
      console.error(`Slide index ${slideIndex} is out of bounds.`);
      return;
    }

    currentSlideIndex = slideIndex;
    const slide = presentationData.slides[slideIndex];
    slideDisplayArea.innerHTML = ''; 

    const slideElement = document.createElement('div');
    slideElement.className = 'slide active';
    slideElement.id = slide.id;

    let contentHTML = '';

    switch (slide.type) {
      case 'title_subtitle':
        contentHTML = `
          <h1 class="title">${slide.title}</h1>
          <h2 class="subtitle">${slide.subtitle}</h2>
        `;
        break;
      case 'explanation_list':
      case 'qa_list':
        contentHTML = `<h2>${slide.title}</h2><div class="explanation-container">`;
        slide.items.forEach(item => {
          contentHTML += `<p data-title="${item.title}" data-content="${item.content}"></p>`;
        });
        contentHTML += `</div>`;
        break;
      case 'features_grid':
        contentHTML = `<h2>${slide.title}</h2><div class="features-grid">`;
        slide.features.forEach(feature => {
          contentHTML += `
            <div class="feature">
              <div class="icon">${feature.icon}</div>
              <h3>${feature.title}</h3>
              <p>${feature.description}</p>
            </div>
          `;
        });
        contentHTML += `</div>`;
        if (slide.footer && slide.footer.length > 0) {
          contentHTML += `<div class="slide-footer">`;
          slide.footer.forEach(item => {
            contentHTML += `
              <div class="footer-item">
                <div class="footer-icon">${item.icon}</div>
                <div class="footer-text">${item.text}</div>
              </div>
            `;
          });
          contentHTML += `</div>`;
        }
        break;
      case 'benefits_list':
        contentHTML = `<h2>${slide.title}</h2><div class="benefits">`;
        slide.benefits.forEach(benefit => {
          contentHTML += `
            <div class="benefit">
              <div class="icon">${benefit.icon}</div>
              <h3>${benefit.title}</h3>
              <p>${benefit.description}</p>
            </div>
          `;
        });
        contentHTML += `</div>`;
        if (slide.footer && slide.footer.length > 0) {
          contentHTML += `<div class="slide-footer">`;
          slide.footer.forEach(item => {
            contentHTML += `
              <div class="footer-item">
                <div class="footer-icon">${item.icon}</div>
                <div class="footer-text">${item.text}</div>
              </div>
            `;
          });
          contentHTML += `</div>`;
        }
        break;
      case 'steps_list':
        contentHTML = `<h2>${slide.title}</h2><div class="modern-steps">`;
        slide.steps.forEach(step => {
          contentHTML += `
            <div class="step-card">
              <div class="step-number">${step.number}</div>
              <div class="step-content">
                <h3><span class="icon">${step.title.includes("ğŸ”") ? "ğŸ”" : step.title.includes("ğŸ”‘") ? "ğŸ”‘" : "âš ï¸"}</span> ${step.title.substring(step.title.indexOf(" ") + 1)}</h3>
                <p>${step.content}</p>
              </div>
            </div>
          `;
        });
        contentHTML += `</div>`;
        if (slide.footer && slide.footer.length > 0) {
          contentHTML += `<div class="slide-footer">`;
          slide.footer.forEach(item => {
            contentHTML += `
              <div class="footer-item">
                <div class="footer-icon">${item.icon}</div>
                <div class="footer-text">${item.text}</div>
              </div>
            `;
          });
          contentHTML += `</div>`;
        }
        break;
      case 'reveal_text':
        contentHTML = `<div class="reveal-slide">
          <h2>${slide.title}</h2>
          <p class="reveal-text">${slide.revealText}</p>
          <p class="highlight">${slide.highlight}</p>
          <p>${slide.additionalText}</p>
        </div>`;
        break;
      case 'closing_title':
        contentHTML = `
          <h1 class="closing-title">${slide.title}</h1>
          <p class="thank-you">${slide.thankYouText}</p>
        `;
        break;
      default:
        contentHTML = `
          <h2>${slide.title || 'Untitled Slide'}</h2>
          <p>Type: ${slide.type}</p>
          <p>(Content rendering for this type is not yet fully implemented or type is unknown.)</p>
        `;
        console.warn(`Unknown slide type: ${slide.type}`);
    }
    slideElement.innerHTML = contentHTML;
    slideDisplayArea.appendChild(slideElement);

    updateProgressBar();
    updateNavigationButtons(); 
    playSlideAnimations(); 
  }

  function updateNavigationButtons() {
    if (!presentationData) { 
      prevBtn.disabled = true;
      nextBtn.disabled = true;
      return;
    }
    prevBtn.disabled = currentSlideIndex === 0;
    nextBtn.disabled = currentSlideIndex >= presentationData.slides.length - 1;
  }

  nextBtn.addEventListener('click', () => {
    if (presentationData && currentSlideIndex < presentationData.slides.length - 1) {
      renderSlide(currentSlideIndex + 1);
    }
  });

  prevBtn.addEventListener('click', () => {
    if (currentSlideIndex > 0) {
      renderSlide(currentSlideIndex - 1);
    }
  });
  
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight') {
      nextBtn.click();
    } else if (e.key === 'ArrowLeft') {
      prevBtn.click();
    }
  });

  if (presentationData && presentationData.slides.length > 0) {
    renderSlide(0);
  } else {
    slideDisplayArea.innerHTML = '<p>No presentation data available.</p>';
    updateNavigationButtons();
  }

  function updateProgressBar() {
    if (!presentationData || presentationData.slides.length === 0) {
        progressBar.style.setProperty('--progress', `0%`);
        return;
    }
    const progress = ((currentSlideIndex + 1) / presentationData.slides.length) * 100;
    progressBar.style.setProperty('--progress', `${progress}%`);
  }

  function playSlideAnimations() {
    if (!presentationData) return;
    
    const currentSlideData = presentationData.slides[currentSlideIndex];
    const currentSlideElement = document.querySelector(`#slide-display-area #${currentSlideData.id}.slide.active`);

    if (!currentSlideElement) {
        console.warn(`playSlideAnimations: Slide element with ID "${currentSlideData.id}" not found in DOM for animation.`);
        return;
    }
    
    anime({
        targets: currentSlideElement,
        opacity: [0, 1],
        duration: 300, 
        easing: 'easeOutExpo',
        complete: () => { 
            const mainTitle = currentSlideElement.querySelector('h2');
            if (mainTitle && currentSlideData.type !== 'title_subtitle' && currentSlideData.type !== 'closing_title') {
                 anime({
                    targets: mainTitle,
                    opacity: [0, 1],
                    translateY: [-20, 0],
                    duration: 800,
                    easing: 'easeOutExpo'
                });
            }

            if (currentSlideData.type === 'title_subtitle') {
              anime({
                targets: `#${currentSlideData.id} .title`,
                opacity: [0, 1],
                translateY: [-30, 0],
                duration: 1000,
                delay: 200, 
                easing: 'easeOutExpo'
              });
              anime({
                targets: `#${currentSlideData.id} .subtitle`,
                opacity: [0, 1],
                translateY: [30, 0],
                duration: 1000,
                delay: 500, 
                easing: 'easeOutExpo'
              });
            }
            else if (currentSlideData.type === 'explanation_list' || currentSlideData.type === 'qa_list') {
              anime({
                targets: `#${currentSlideData.id} .explanation-container p`,
                opacity: [0, 1],
                translateY: [20, 0],
                duration: 800,
                delay: anime.stagger(200, {start: 300}), 
                easing: 'easeOutExpo'
              });
            }
            else if (currentSlideData.type === 'features_grid') {
              anime({
                targets: `#${currentSlideData.id} .feature`,
                opacity: [0, 1],
                scale: [0.8, 1],
                duration: 800,
                delay: anime.stagger(150, {start: 300}),
                easing: 'spring(1, 80, 10, 0)'
              });
               const footer = currentSlideElement.querySelector('.slide-footer');
               if (footer) {
                 anime({ targets: footer, opacity: [0,1], translateY: [15,0], duration: 800, delay: 700, easing: 'easeOutExpo'});
               }
            }
            else if (currentSlideData.type === 'benefits_list') {
              anime({
                targets: `#${currentSlideData.id} .benefit`,
                opacity: [0, 1],
                translateX: [-30, 0],
                duration: 700,
                delay: anime.stagger(200, {start: 300}),
                easing: 'easeOutExpo'
              });
              anime({
                targets: `#${currentSlideData.id} .benefit .icon`,
                rotate: ['-180deg', '0deg'],
                scale: [0,1],
                duration: 1000,
                delay: anime.stagger(200, {start: 400}),
                easing: 'spring(1,80,10,0)'
              });
              const footer = currentSlideElement.querySelector('.slide-footer');
              if (footer) {
                anime({ targets: footer, opacity: [0,1], translateY: [15,0], duration: 800, delay: 800, easing: 'easeOutExpo'});
              }
            }
            else if (currentSlideData.type === 'steps_list') {
              anime({
                targets: `#${currentSlideData.id} .step-card`,
                opacity: [0, 1],
                translateY: [30, 0],
                duration: 800,
                delay: anime.stagger(250, {start: 300}),
                easing: 'easeOutExpo'
              });
              const footer = currentSlideElement.querySelector('.slide-footer');
              if (footer) {
                anime({ targets: footer, opacity: [0,1], translateY: [15,0], duration: 800, delay: 900, easing: 'easeOutExpo'});
              }
            }
            else if (currentSlideData.type === 'reveal_text') {
                anime({
                    targets: `#${currentSlideData.id} .reveal-text`,
                    opacity: [0, 1],
                    translateY: [20, 0],
                    duration: 1000,
                    delay: 500, 
                    easing: 'easeOutExpo'
                });
                anime({
                    targets: `#${currentSlideData.id} .highlight`,
                    scale: [0.8, 1],
                    opacity: [0, 1],
                    duration: 1200,
                    delay: 1200, 
                    easing: 'spring(1, 80, 10, 0)'
                });
                const additionalP = currentSlideElement.querySelectorAll('p');
                if(additionalP.length > 2) { 
                     anime({
                        targets: additionalP[additionalP.length -1], 
                        opacity: [0,1],
                        translateY: [20,0],
                        duration: 800,
                        delay: 2000,
                        easing: 'easeOutExpo'
                    });
                }
            }
             else if (currentSlideData.type === 'closing_title') {
              anime({
                targets: `#${currentSlideData.id} .closing-title`,
                opacity: [0, 1],
                scale: [0.9, 1],
                duration: 1200,
                delay: 200,
                easing: 'easeOutExpo'
              });
              anime({
                targets: `#${currentSlideData.id} .thank-you`,
                opacity: [0, 1],
                translateY: [20, 0],
                duration: 1000,
                delay: 800,
                easing: 'easeOutExpo'
              });
            }
        }
    });
  }
});
